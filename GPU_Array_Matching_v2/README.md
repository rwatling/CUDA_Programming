# GPU Array Matching

Author: Robbie Watling BS

## Description
This is the second version of the GPU match experiment.

## Requirements
* NVIDIA Capable GPU
* GPU needs to have a maximum shared memory size greater than or equal to 64 kibibytes
* CMake version >= 3.8
* Make
* CUDA library and compiler `nvcc`

## Build instructions
This project relies on the `nvcc` compiler and `cmake` commands.

* Make the executable `gpu_matching`:<br>
`cmake .` in the base directory<br>
 followed by a `make` <br>

* Run a single run of the program:<br>
`./gpu_matching num_threads` in the base directory

## Advanced Build instructions
To further customize the build options you can use <br>
`cmake . -D<option name>=1 -D<option name>=0...` <br>
followed by a `make` <br>

* `ARRAY_SIZE=(4, 8, 12, 16, 24)` to change array size <br>
  * Note: Shared memory is limited on some platforms. <br>
  * Platforms for development: <br>
    * 1650TiMobile = 65kb or up to 16 array elements for 1024 arrays <br>
    * RTX 2XXX = 98kb or up to 24 array elements for 1024 arrays <br>

* `DEBUG=(0 or 1)` to print debug information and run sequential CPU_Verification <br>

* `LG_REL_HASH=(0 or 1)` the relative hash table size for hash table versions
  * `LG_REL_HASH=0` we choose `HASH_SIZE = <smallest prime greater than ARRAY_SIZE>` <br> approximately `1.3 * ARRAY_SIZE` <br>
  * `LG_REL_HASH=1` we choose `HASH_SIZE = <second smallest prime greater than ARRAY_SIZE>` <br> which is `> 1.3 * ARRAY_SIZE` <br>

* `MEM_OPT=(0 or 1)` for obtaining memory profiling information

## Edit instructions
Source files are in the `src/` folder <br>

* `main.cu`: main function that coordinates calls to the GPU
* `shm_array_match.cu`: function that conducts the array matching via shared memory
* `shfl_array_match.cu`: function that conducts the array matching via shuffling registers
* `shm_hash_match.cu`: function that conducts the array matching via shared memory with hash table lookup
* `shfl_hash_match.cu`: function that conducts the array matching via shuffling registers with hash table lookup
* `bs_match.cu`: function that assumes sorted arrays and uses binary search for finding the match
* `cpu_array_match.cu`: function for sequentially finding the match arrays. Only used if DEBUG=1
* `hash_match.cu`: function that performs the match with a hash table
* `match.cu`: function that uses a naive nested loop implementation for finding a match
* `shfl_bs_match`: shuffle communication function with binary search match
* `shfl_unroll_match`: shuffle communication function with loop unrolling (factor 4)
* `shfl_unroll2_match`: shuffle communication function with loop unrolling (factor 2)
* `unroll_match`: match with loop unrolling (factor 4)
* `unroll_match2`: match with loop unrolling (factor 2)

Important header files:
* `include/nvmlClass.h`: Class for Nvidia Management Library for physical hardware information. Developed by Matthew Nicely, in the repository https://github.com/mnicely/nvml_examples

## Analysis instructions
* `performance.sh` executes the program 3 times at thread numbers 2 to 1024
* `analysis.R` is the driver for the analysis of csv files generated by the bash script
